name: Weekly Data Archive ğŸ“¦

on:
  schedule:
    # é€™è£¡è¨­å®šæ™‚é–“ï¼šæ¯é€±ä¸€çš„å‡Œæ™¨ 00:00 (UTC) åŸ·è¡Œ
    # ä½ å¯ä»¥ç”¨ https://crontab.guru/ ä¾†èª¿æ•´æ™‚é–“
    - cron: '0 0 * * 1' 
  
  # å…è¨±ä½ æ‰‹å‹•æŒ‰æŒ‰éˆ•è§¸ç™¼ (æ–¹ä¾¿æ¸¬è©¦ç”¨)
  workflow_dispatch:

permissions:
  contents: write  # çµ¦äºˆæ©Ÿå™¨äººå¯«å…¥ Repo çš„æ¬Šé™ (é‡è¦ï¼)

jobs:
  update-csv:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          pip install pandas firebase-admin

      - name: Run Update Script
        env:
          FIREBASE_CREDENTIALS: ${{ secrets.FIREBASE_CREDENTIALS }}
        run: python update_csv.py

      - name: Commit and Push changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add news_history.csv
          # å¦‚æœæ²’æœ‰è®Šæ›´ï¼Œcommit æœƒå¤±æ•—ï¼Œæ‰€ä»¥åŠ å€‹ || echo é˜²æ­¢å ±éŒ¯
          git commit -m "chore: auto-archive weekly news data" || echo "No changes to commit"
          git push
